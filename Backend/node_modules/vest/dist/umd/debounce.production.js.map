{"version":3,"file":"debounce.production.js","sources":["../../src/exports/debounce.ts"],"sourcesContent":["import { registerReconciler } from 'vest';\nimport { CB, isPromise, Nullable } from 'vest-utils';\nimport { Isolate, TIsolate, IsolateSelectors } from 'vestjs-runtime';\n\nimport { TestFn, TestFnPayload } from 'TestTypes';\n\nconst isolateType = 'Debounce';\n\nexport default function debounce<Callback extends CB = CB>(\n  callback: Callback,\n  delay: number = 0,\n): TestFn {\n  let timeout: Nullable<NodeJS.Timeout> = null;\n\n  const f = () => (payload: TestFnPayload) =>\n    new Promise((resolve, reject) => {\n      timeout = setTimeout(() => {\n        let res = false;\n        try {\n          res = callback(payload);\n        } catch (e) {\n          return reject(e);\n        }\n\n        if (res === false) {\n          return reject();\n        }\n\n        return isPromise(res) ? res.then(resolve, reject) : resolve(res);\n      }, delay);\n    });\n\n  const i = Isolate.create(isolateType, f, {\n    clearTimeout: () => {\n      if (timeout) {\n        clearTimeout(timeout);\n      }\n    },\n  });\n\n  return i.output;\n}\n\nexport class IsolateDebounceReconciler {\n  static match(currentNode: TIsolate, historyNode: TIsolate): boolean {\n    return (\n      IsolateSelectors.isIsolateType(currentNode, isolateType) &&\n      IsolateSelectors.isIsolateType(historyNode, isolateType)\n    );\n  }\n\n  static reconcile(current: TIsolateDebounce, history: TIsolateDebounce) {\n    history?.data?.clearTimeout?.();\n\n    return current;\n  }\n}\n\nexport type TIsolateDebounce = TIsolate<IsolateDebouncePayload>;\n\nexport type IsolateDebouncePayload = {\n  clearTimeout: () => void;\n};\n\nregisterReconciler(IsolateDebounceReconciler);\n"],"names":["isolateType","IsolateDebounceReconciler","static","currentNode","historyNode","IsolateSelectors","isIsolateType","current","history","_b","_a","data","clearTimeout","call","vest","registerReconciler","callback","delay","timeout","Isolate","create","payload","Promise","resolve","reject","setTimeout","res","e","isPromise","then","output"],"mappings":"sYAMA,MAAMA,EAAc,iBAqCPC,EACXC,aAAaC,EAAuBC,GAClC,OACEC,mBAAiBC,cAAcH,EAAaH,IAC5CK,EAAAA,iBAAiBC,cAAcF,EAAaJ,EAE/C,CAEDE,iBAAiBK,EAA2BC,WAG1C,OAF2B,QAA3BC,EAAa,QAAbC,EAAAF,aAAO,EAAPA,EAASG,YAAI,IAAAD,OAAA,EAAAA,EAAEE,oBAAY,IAAAH,GAAAA,EAAAI,KAAAH,GAEpBH,CACR,EASeO,EAAAC,mBAACd,2CAxDK,SACtBe,EACAC,EAAgB,GAEhB,IAAIC,EAAoC,KA4BxC,OARUC,EAAOA,QAACC,OAAOpB,GAlBf,IAAOqB,GACf,IAAIC,SAAQ,CAACC,EAASC,KACpBN,EAAUO,YAAW,KACnB,IAAIC,GAAM,EACV,IACEA,EAAMV,EAASK,EAGhB,CAFC,MAAOM,GACP,OAAOH,EAAOG,EACf,CAED,OAAY,IAARD,EACKF,IAGFI,EAASA,UAACF,GAAOA,EAAIG,KAAKN,EAASC,GAAUD,EAAQG,EAAI,GAC/DT,EAAM,KAG4B,CACvCL,aAAc,KACRM,GACFN,aAAaM,EACd,IAIIY,MACX"}