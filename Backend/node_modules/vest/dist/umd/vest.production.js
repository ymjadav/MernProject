!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("n4s"),require("vest-utils"),require("vestjs-runtime"),require("context")):"function"==typeof define&&define.amd?define(["exports","n4s","vest-utils","vestjs-runtime","context"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).vest={},t.n4s,t["vest-utils"],t["vestjs-runtime"],t.context)}(this,(function(t,e,n,s,i){"use strict";const r="Each",a="Focused",o="Group",u="OmitWhen",c="SkipWhen",l="Suite",E="Test";class d{static setOptionalField(t,e,s){const i=t.data.optional,r=i[e];n.assign(i,{[e]:n.assign({},r,s(r))})}static getOptionalField(t,e){var n;return null!==(n=d.getOptionalFields(t)[e])&&void 0!==n?n:{}}static getOptionalFields(t){var e,n;return null!==(n=null===(e=t.data)||void 0===e?void 0:e.optional)&&void 0!==n?n:{}}}var f,N;!function(t){t[t.CUSTOM_LOGIC=0]="CUSTOM_LOGIC",t[t.AUTO=1]="AUTO"}(f||(f={})),t.Modes=void 0,(N=t.Modes||(t.Modes={})).EAGER="EAGER",N.ALL="ALL",N.ONE="ONE";const T=i.createCascade(((e,s)=>s?null:n.assign({inclusion:{},mode:n.tinyState.createTinyState(t.Modes.EAGER),suiteParams:[],testMemoCache:R},e)));function g(){return T.useX().inclusion}function S(){return T.useX().mode()}const R=n.cache(10);function I(t){var i;const r=s.VestRuntime.useAvailableRoot(),a=T.useX().suiteParams,o=null!==(i=null==a?void 0:a[0])&&void 0!==i?i:{};if(n.isArray(t)||n.isStringValue(t))n.asArray(t).forEach((t=>{d.setOptionalField(r,t,(()=>({type:f.AUTO,applied:!!n.hasOwnProperty(o,t)&&e.enforce.isBlank().test(null==o?void 0:o[t]),rule:null})))}));else for(const n in t){const s=t[n];d.setOptionalField(r,n,(()=>({type:f.CUSTOM_LOGIC,rule:s,applied:e.enforce.isBlank().test(s)||!0===s})))}}function m(t){var e,n;if(!t)return!1;const i=s.VestRuntime.useAvailableRoot();return null!==(n=null===(e=d.getOptionalField(i,t))||void 0===e?void 0:e.applied)&&void 0!==n&&n}var p;!function(t){t.HOOK_CALLED_OUTSIDE="hook called outside of a running suite.",t.EXPECTED_VEST_TEST="Expected value to be an instance of IsolateTest",t.FIELD_NAME_REQUIRED="Field name must be passed",t.SUITE_MUST_BE_INITIALIZED_WITH_FUNCTION="Suite must be initialized with a function",t.PROMISIFY_REQUIRE_FUNCTION="Vest.Promisify must be called with a function",t.PARSER_EXPECT_RESULT_OBJECT="Vest parser: expected argument at position 0 to be Vest's result object.",t.WARN_MUST_BE_CALLED_FROM_TEST="Warn must be called from within the body of a test function",t.EACH_CALLBACK_MUST_BE_A_FUNCTION="Each must be called with a function",t.INVALID_PARAM_PASSED_TO_FUNCTION='Incompatible params passed to {fn_name} function. "{param}" must be of type {expected}',t.TESTS_CALLED_IN_DIFFERENT_ORDER='Vest Critical Error: Tests called in different order than previous run.\n    expected: {fieldName}\n    received: {prevName}\n    This can happen on one of two reasons:\n    1. You\'re using if/else statements to conditionally select tests. Instead, use "skipWhen".\n    2. You are iterating over a list of tests, and their order changed. Use "each" and a custom key prop so that Vest retains their state.',t.UNEXPECTED_TEST_REGISTRATION_ERROR="Unexpected error encountered during test registration.\n      Please report this issue to Vest's Github repository.\n      Test Object: {testObject}.\n      Error: {error}.",t.UNEXPECTED_TEST_RUN_ERROR="Unexpected error encountered during test run. Please report this issue to Vest's Github repository.\n      Test Object: {testObject}.",t.INCLUDE_SELF="Trying to call include.when on the same field."}(p||(p={}));const _="PENDING",O="INITIAL",D={[_]:_,[O]:O,DONE:"DONE"},v={initial:D.INITIAL,states:{[D.DONE]:{},[D.INITIAL]:{[D.PENDING]:D.PENDING,[D.DONE]:D.DONE},[D.PENDING]:{[D.DONE]:D.DONE}}};function A(t,e){return h.staticTransition(null!=t?t:D.INITIAL,e)}const h=n.StateMachine(v),C={[_]:_,CANCELED:"CANCELED",FAILED:"FAILED",OMITTED:"OMITTED",PASSING:"PASSING",SKIPPED:"SKIPPED",UNTESTED:"UNTESTED",WARNING:"WARNING"},P="RESET",F={initial:C.UNTESTED,states:{"*":{[C.OMITTED]:C.OMITTED,[P]:C.UNTESTED},[C.UNTESTED]:{[C.CANCELED]:C.CANCELED,[C.FAILED]:C.FAILED,[C.PASSING]:C.PASSING,[C.PENDING]:C.PENDING,[C.SKIPPED]:C.SKIPPED,[C.WARNING]:C.WARNING},[C.PENDING]:{[C.CANCELED]:C.CANCELED,[C.FAILED]:C.FAILED,[C.PASSING]:C.PASSING,[C.SKIPPED]:[C.SKIPPED,t=>!0===t],[C.WARNING]:C.WARNING},[C.SKIPPED]:{},[C.FAILED]:{},[C.WARNING]:{},[C.PASSING]:{},[C.CANCELED]:{},[C.OMITTED]:{}}},L=n.StateMachine(F);var U,y,b,W;function G(t){return t===U.ERRORS?y.ERROR_COUNT:y.WARN_COUNT}!function(t){t.WARNINGS="warnings",t.ERRORS="errors"}(U||(U={})),function(t){t.ERROR_COUNT="errorCount",t.WARN_COUNT="warnCount"}(y||(y={})),function(t){t.Error="error",t.Warning="warning"}(b||(b={}));class V{static getStatus(t){var e;return null!==(e=t.status)&&void 0!==e?e:O}static setStatus(t,e,n){t.status=this.stateMachine.staticTransition(V.getStatus(t),e,n)}static statusEquals(t,e){return V.getStatus(t)===e}static setPending(t){this.setStatus(t,_)}static isPending(t){return V.statusEquals(t,_)}}V.stateMachine=h;class M extends V{static getData(t){return n.invariant(t.data),t.data}static is(t){return s.IsolateSelectors.isIsolateType(t,E)}static isX(t){n.invariant(M.is(t),p.EXPECTED_VEST_TEST)}static cast(t){return M.isX(t),t}static warns(t){return M.getData(t).severity===b.Warning}static isOmitted(t){return M.statusEquals(t,C.OMITTED)}static isUntested(t){return M.statusEquals(t,C.UNTESTED)}static isFailing(t){return M.statusEquals(t,C.FAILED)}static isCanceled(t){return M.statusEquals(t,C.CANCELED)}static isSkipped(t){return M.statusEquals(t,C.SKIPPED)}static isPassing(t){return M.statusEquals(t,C.PASSING)}static isWarning(t){return M.statusEquals(t,C.WARNING)}static hasFailures(t){return M.isFailing(t)||M.isWarning(t)}static isNonActionable(t){return M.isSkipped(t)||M.isOmitted(t)||M.isCanceled(t)}static isTested(t){return M.hasFailures(t)||M.isPassing(t)}static awaitsResolution(t){return M.isSkipped(t)||M.isUntested(t)||M.isPending(t)}static isAsyncTest(t){return n.isPromise(M.getData(t).asyncTest)}static fail(t){M.setStatus(t,M.warns(t)?C.WARNING:C.FAILED)}static pass(t){M.setStatus(t,C.PASSING)}static warn(t){M.setData(t,(t=>Object.assign(Object.assign({},t),{severity:b.Warning})))}static setData(t,e){t.data=n.optionalFunctionValue(e,M.getData(t))}static skip(t,e){M.setStatus(t,C.SKIPPED,e)}static cancel(t){M.setStatus(t,C.CANCELED),s.IsolateMutator.abort(t,C.CANCELED)}static omit(t){M.setStatus(t,C.OMITTED)}static reset(t){M.setStatus(t,P)}}function k(t,e){return!!e&&!B(t,e)}function B(t,e){return!(!e||t.fieldName!==e)}function w(t,e){const{groupName:n}=M.getData(t),{groupName:s,fieldName:i}=M.getData(e);return B(M.getData(t),i)&&n===s&&t.key==e.key}function j(t,e){return s.Isolate.create(a,n.noop,{focusMode:t,match:n.asArray(e).filter(n.isStringValue),matchAll:!0===e})}M.stateMachine=L,function(t){t[t.ONLY=0]="ONLY",t[t.SKIP=1]="SKIP"}(W||(W={}));class K{static isSkipFocused(t,e){return(null==t?void 0:t.data.focusMode)===W.SKIP&&(H(t,e)||!0===t.data.matchAll)}static isOnlyFocused(t,e){return(null==t?void 0:t.data.focusMode)===W.ONLY&&H(t,e)}static isIsolateFocused(t){return s.IsolateSelectors.isIsolateType(t,a)}}function x(t){return j(W.ONLY,q(t))}function X(t){return j(W.SKIP,q(t))}function q(t){return!1===t?[]:t}function H(t,e){var s,i;return n.isNotEmpty(null==t?void 0:t.data.match)&&(!e||(null===(i=null===(s=null==t?void 0:t.data.match)||void 0===s?void 0:s.includes(e))||void 0===i||i))}const Y=n.cache();function z(){return s.VestRuntime.useXAppData()}function J(){return z().doneCallbacks()}function Q(){return z().fieldCallbacks()}function Z(){return z().suiteId}function $(){z().suiteResultCache.invalidate([Z()])}function tt(){const[,,t]=J(),[,,e]=Q();t(),e()}function et(t){s.VestRuntime.useLoadRootNode(t),$()}function nt(t,e,s){return s?function(t,e,n){var s;return(null===(s=null==t?void 0:t[n])||void 0===s?void 0:s[e])||[]}(t,e,s):function(t,e){const s={},i=G(e);for(const r in t)n.isPositive(t[r][i])&&(s[r]=t[r][e]||[]);return s}(t,e)}function st(t){const e={getError:function(e){return ct(U.ERRORS,t,e)},getErrors:function(e){return it(t,U.ERRORS,e)},getErrorsByGroup:function(e,n){return rt(t,U.ERRORS,e,n)},getWarning:function(e){return ct(U.WARNINGS,t,e)},getWarnings:function(e){return it(t,U.WARNINGS,e)},getWarningsByGroup:function(e,n){return rt(t,U.WARNINGS,e,n)},hasErrors:function(e){return ut(t,y.ERROR_COUNT,e)},hasErrorsByGroup:function(e,n){return ot(t,y.ERROR_COUNT,e,n)},hasWarnings:function(e){return ut(t,y.WARN_COUNT,e)},hasWarningsByGroup:function(e,n){return ot(t,y.WARN_COUNT,e,n)},isPending:function(e){var s;return e?n.greaterThan(null===(s=t.tests[e])||void 0===s?void 0:s.pendingCount,0):n.greaterThan(t.pendingCount,0)},isTested:function(e){var s;return n.isPositive(null===(s=t.tests[e])||void 0===s?void 0:s.testCount)},isValid:function(e){var n;return e?Boolean(null===(n=t.tests[e])||void 0===n?void 0:n.valid):t.valid},isValidByGroup:function(e,n){const s=t.groups[e];if(!s)return!1;if(n)return at(s,n);for(const t in s)if(!at(s,t))return!1;return!0}};return e}function it(t,e,n){return nt(t.tests,e,n)}function rt(t,e,n,s){return nt(t.groups[n],e,s)}function at(t,e){var n;return!!(null===(n=t[e])||void 0===n?void 0:n.valid)}function ot(t,e,s,i){var r,a;const o=t.groups[s];if(!o)return!1;if(i)return n.isPositive(null===(r=o[i])||void 0===r?void 0:r[e]);for(const t in o)if(n.isPositive(null===(a=o[t])||void 0===a?void 0:a[e]))return!0;return!1}function ut(t,e,s){var i;const r=s?null===(i=t.tests[s])||void 0===i?void 0:i[e]:t[e]||0;return n.isPositive(r)}function ct(t,e,n){var s;const i=e[t];return n?null===(s=i.find((t=>B(t,n))))||void 0===s?void 0:s.message:i[0]}var lt,Et;class dt{constructor(){this.errorCount=0,this.warnCount=0,this.testCount=0,this.pendingCount=0}}class ft extends dt{constructor(){super(...arguments),this[lt]=[],this[Et]=[],this.groups={},this.tests={},this.valid=!1}}lt=U.ERRORS,Et=U.WARNINGS;class Nt{constructor(t,e,n){this.fieldName=t,this.message=e,this.groupName=n}static fromTestObject(t){const{fieldName:e,message:n,groupName:s}=M.getData(t);return new Nt(e,n,s)}}class Tt{static hasNoTests(t=Tt.defaultRoot()){return!t||!s.Walker.has(t,M.is)}static someTests(t,e=Tt.defaultRoot()){return!!e&&s.Walker.some(e,(e=>(M.isX(e),t(e))),M.is)}static everyTest(t,e=Tt.defaultRoot()){return!!e&&s.Walker.every(e,(e=>(M.isX(e),t(e))),M.is)}static walkTests(t,e=Tt.defaultRoot()){e&&s.Walker.walk(e,((e,n)=>{t(M.cast(e),n)}),M.is)}static pluckTests(t,e=Tt.defaultRoot()){e&&s.Walker.pluck(e,(e=>(M.isX(e),t(e))),M.is)}static resetField(t){Tt.walkTests((e=>{B(M.getData(e),t)&&M.reset(e)}),Tt.defaultRoot())}static removeTestByFieldName(t,e=Tt.defaultRoot()){Tt.pluckTests((e=>B(M.getData(e),t)),e)}}Tt.defaultRoot=s.VestRuntime.useAvailableRoot;class gt{static hasPending(t){const e=gt.defaultRoot();return!!e&&s.Walker.some(e,n.Predicates.all(V.isPending,null==t||t))}static hasRemainingWithTestNameMatching(t){return gt.hasPending(n.Predicates.any(n.isNullish(t),n.Predicates.all(M.is,(e=>function(t,e){return!e||B(t,e)}(M.getData(e),t)))))}}gt.defaultRoot=s.VestRuntime.useAvailableRoot;const St=n.bindNot((function(t,e){return M.getData(t).groupName===e}));function Rt(t){return function(t,e){return Tt.someTests((n=>It(n,t,e)))}(U.ERRORS,t)}function It(t,e,s){return!!M.hasFailures(t)&&(!k(M.getData(t),s)&&!function(t,e){return n.either(t===U.WARNINGS,M.warns(e))}(e,t))}function mt(t){return!!m(t)||!Tt.hasNoTests()&&(!Rt(t)&&(!function(t){return gt.hasPending(n.Predicates.all(M.is,(e=>!k(M.getData(e),t)),(()=>!m(t))))}(t)&&function(t){return Tt.everyTest((e=>_t(e,t)))}(t)))}function pt(t,e){return!!m(e)||!function(t,e,n){return Tt.someTests((s=>!St(s,e)&&It(s,t,n)))}(U.ERRORS,t,e)&&(!function(t,e){return gt.hasPending(n.Predicates.all(M.is,(e=>!St(e,t)),(t=>!k(M.getData(t),e)),(()=>!m(e))))}(t,e)&&function(t,e){return Tt.everyTest((n=>!!St(n,t)||_t(n,e)))}(t,e))}function _t(t,e){return!!k(M.getData(t),e)||(M.isOmitted(t)||M.isTested(t)||function(t){const e=s.VestRuntime.useAvailableRoot(),{fieldName:n}=M.getData(t);return d.getOptionalField(e,n).type===f.AUTO&&M.awaitsResolution(t)}(t))}function Ot(){const t=new ft;return Tt.walkTests((e=>{t.tests=function(t,e){const n=M.getData(e).fieldName,s=Object.assign({},t);return s[n]=vt(s[n],e),s[n].valid=!1!==s[n].valid&&mt(n),s}(t.tests,e),t.groups=function(t,e){const{groupName:n,fieldName:s}=M.getData(e);if(!n)return t;const i=Object.assign({},t);return i[n]=i[n]||{},i[n][s]=vt(i[n][s],e),i[n][s].valid=!1!==i[n][s].valid&&pt(n,s),i}(t.groups,e),t.errors=Dt(U.ERRORS,t.errors,e),t.warnings=Dt(U.WARNINGS,t.warnings,e)})),t.valid=mt(),function(t){for(const e in t.tests)t.errorCount+=t.tests[e].errorCount,t.warnCount+=t.tests[e].warnCount,t.testCount+=t.tests[e].testCount,t.pendingCount+=t.tests[e].pendingCount;return t}(t)}function Dt(t,e,n){if(M.isOmitted(n))return e;return(t===U.WARNINGS?M.isWarning(n):M.isFailing(n))?e.concat(Nt.fromTestObject(n)):e}function vt(t,e){const{message:s}=M.getData(e),i=n.defaultTo(t?Object.assign({},t):null,At);return M.isNonActionable(e)||(M.isPending(e)&&i.pendingCount++,M.isFailing(e)?r(U.ERRORS):M.isWarning(e)&&r(U.WARNINGS),i.testCount++),i;function r(t){const e=G(t);i[e]++,s&&(i[t]=(i[t]||[]).concat(s))}}function At(){return n.assign(new dt,{errors:[],valid:!0,warnings:[]})}function ht(){return t=()=>{const t=Ot(),e=z().suiteName;return Object.freeze(n.assign(t,st(t),{suiteName:e}))},(0,z().suiteResultCache)([Z()],t);var t}function Ct(t,e){s.Isolate.create(c,(()=>{T.run({skipped:Pt()||n.optionalFunctionValue(t,n.optionalFunctionValue(ht))},e)}))}function Pt(){return function(){var t;return null!==(t=T.useX().skipped)&&void 0!==t&&t}()}function Ft(t,e){return n.isNotNullish(s.Walker.findClosest(t,(t=>!!K.isIsolateFocused(t)&&K.isOnlyFocused(t,e))))}function Lt(t){const{fieldName:e}=M.getData(t);if(Pt())return!0;const i=g(),r=function(t){return s.Walker.findClosest(t,(e=>{var n;if(!K.isIsolateFocused(e))return!1;const{fieldName:s}=M.getData(t);return(null===(n=e.data.match)||void 0===n?void 0:n.includes(s))||e.data.matchAll}))}(t);if(K.isSkipFocused(r))return!0;return!K.isOnlyFocused(r)&&(!!Ft(t)&&!n.optionalFunctionValue(i[e],t))}function Ut(t){const[e]=S();return e===t}function yt(e){return Ut(t.Modes.ONE)?Rt():!!Ut(t.Modes.EAGER)&&Rt(e.fieldName)}function bt(t,e){s.Isolate.create(u,(()=>{T.run({omitted:Wt()||n.optionalFunctionValue(t,n.optionalFunctionValue(ht))},e)}))}function Wt(){return function(){var t;return null!==(t=T.useX().omitted)&&void 0!==t&&t}()}function Gt(t,e=t){const n=M.getData(t);return yt(n)?(s=t,M.skip(s),s):(i=n.fieldName,Wt()||m(i)?function(t){return M.omit(t),t}(t):Lt(t)?function(t){return M.skip(t,Pt()),t}(e):t);var s,i}function Vt(t,e){return M.is(e)&&!w(e,t)}const Mt=[class{static match(t,e){return M.is(t)&&M.is(e)}static reconcile(t,e){const i=Gt(t,function(t,e){if(s.IsolateInspector.usesKey(t))return function(t){return M.cast(s.Reconciler.handleIsolateNodeWithKey(t,(e=>!!M.isNonActionable(e)||!Lt(t))))}(t);if(s.Reconciler.dropNextNodesOnReorder(Vt,t,e))return function(t,e){if(s.IsolateInspector.canReorder(t))return;n.deferThrow(n.text(p.TESTS_CALLED_IN_DIFFERENT_ORDER,{fieldName:M.getData(t).fieldName,prevName:M.is(e)?M.getData(e).fieldName:void 0}))}(t,e),t;if(!M.is(e))return t;if(M.isOmitted(e))return t;return e}(t,e));return function(t,e,n){t===e&&M.is(e)&&(i=e)!==(s=n)&&w(s,i)&&M.isPending(s)&&M.cancel(s);var s,i}(i,t,e),i}}];function kt(t,e){var n,s;return null!==(s=null===(n=Mt.find((n=>n.match(t,e))))||void 0===n?void 0:n.reconcile(t,e))&&void 0!==s?s:null}function Bt(...t){const[e,n]=t.reverse();return s.Isolate.create(o,(()=>T.run(Object.assign({},n&&{groupName:n}),e)))}function wt(t){n.invariant(n.isStringValue(t));return g()[t]=!0,{when:function(e){n.invariant(e!==t,p.INCLUDE_SELF);g()[t]=function(t){return n.isStringValue(e)?Ft(t,e):n.optionalFunctionValue(e,n.optionalFunctionValue(ht))}}}}var jt;function Kt(t,e,n){const i=Object.assign(Object.assign({},{severity:b.Error,status:L.initial()}),{fieldName:e.fieldName,testFn:e.testFn});e.groupName&&(i.groupName=e.groupName),e.message&&(i.message=e.message);return s.Isolate.create(E,t,i,null!=n?n:null)}function xt(t){if(Gt(t),M.isUntested(t))return function(t){const e=function(t){return T.run({currentTest:t},(()=>{let e;const{message:s,testFn:i}=M.getData(t);try{e=i({signal:t.abortController.signal})}catch(i){(function(t,e){return n.isUndefined(t)&&n.isStringValue(e)})(s,i)&&(M.getData(t).message=i),e=!1}return!1===e&&M.fail(t),e}))}(t);try{if(n.isPromise(e))return M.getData(t).asyncTest=e,function(t){const{asyncTest:e,message:i}=M.getData(t);if(!n.isPromise(e))return;const r=s.VestRuntime.persist((()=>{Xt(t)})),a=s.VestRuntime.persist((e=>{M.isCanceled(t)||(M.getData(t).message=n.isStringValue(e)?e:i,M.fail(t),r())}));return e.then(r,a)}(t);Xt(t)}catch(e){throw new Error(n.text(p.UNEXPECTED_TEST_REGISTRATION_ERROR,{testObject:JSON.stringify(t),error:e}))}}(t);M.isNonActionable(t)||n.deferThrow(n.text(p.UNEXPECTED_TEST_REGISTRATION_ERROR,{testObject:JSON.stringify(t)}))}function Xt(t){M.pass(t)}function qt(t,...e){const[i,r,a]=n.isFunction(e[1])?e:[void 0,...e];!function(t,e){const s="test";n.invariant(n.isStringValue(t),n.text(p.INVALID_PARAM_PASSED_TO_FUNCTION,{fn_name:s,param:"fieldName",expected:"string"})),n.invariant(n.isFunction(e),n.text(p.INVALID_PARAM_PASSED_TO_FUNCTION,{fn_name:s,param:"callback",expected:"function"}))}(t,r);const o={fieldName:t,groupName:T.useX().groupName,message:i,testFn:r};return s.Bus.useEmit(jt.TEST_RUN_STARTED),Kt(xt,o,a)}!function(t){t.TEST_RUN_STARTED="test_run_started",t.TEST_COMPLETED="test_completed",t.ALL_RUNNING_TESTS_FINISHED="all_running_tests_finished",t.REMOVE_FIELD="remove_field",t.RESET_FIELD="reset_field",t.RESET_SUITE="reset_suite",t.SUITE_RUN_STARTED="suite_run_started",t.SUITE_CALLBACK_RUN_FINISHED="SUITE_CALLBACK_RUN_FINISHED",t.DONE_TEST_OMISSION_PASS="DONE_TEST_OMISSION_PASS"}(jt||(jt={}));const Ht=n.assign(qt,{memo:function(t){return function(e,...i){const[r,a,o]=i.reverse();return function(t,e){const i=T.useX().testMemoCache,r=i.get(t);if(n.isNull(r))return i(t,e);const[,a]=r;if(M.isCanceled(a))return i.invalidate(t),i(t,e);return s.VestRuntime.addNodeToHistory(a),a}([Z(),e,s.VestRuntime.useCurrentCursor()].concat(r),(function(){return t(e,o,a)}))}}(qt)});function Yt(){return{group:Bt,include:wt,omitWhen:bt,only:x,optional:I,skip:X,skipWhen:Ct,test:Ht}}function zt(){const t=s.VestRuntime.useAvailableRoot(),e=d.getOptionalFields(t);if(n.isEmpty(e))return;const i=new Set;function r(e){const{fieldName:n}=M.getData(e);i.has(n)&&(M.omit(e),d.setOptionalField(t,n,(t=>Object.assign(Object.assign({},t),{applied:!0}))))}Tt.walkTests((e=>{if(M.isPending(e))return;const{fieldName:s}=M.getData(e);i.has(s)?r(e):function(e){const{fieldName:s}=M.getData(e),a=d.getOptionalField(t,s);!0===n.optionalFunctionValue(a.rule)&&i.add(s);r(e)}(e)})),s.Bus.useEmit(jt.DONE_TEST_OMISSION_PASS)}function Jt(){const t=s.Bus.useBus();return e(jt.TEST_COMPLETED,(t=>{if(M.isCanceled(t))return;const{fieldName:e}=M.getData(t);!function(t){const[e]=Q();t&&!gt.hasRemainingWithTestNameMatching(t)&&n.isArray(e[t])&&n.callEach(e[t])}(e)})),e(jt.TEST_RUN_STARTED,(()=>{})),e(s.RuntimeEvents.ISOLATE_PENDING,(t=>{M.is(t)&&M.setPending(t),function(t){t.status=A(t.status,D.PENDING)}(t)})),e(s.RuntimeEvents.ISOLATE_DONE,(e=>{M.is(e)&&t.emit(jt.TEST_COMPLETED,e),function(t){t.status=A(t.status,D.DONE)}(e),gt.hasPending()||t.emit(jt.ALL_RUNNING_TESTS_FINISHED)})),e(jt.DONE_TEST_OMISSION_PASS,(()=>{})),e(jt.ALL_RUNNING_TESTS_FINISHED,(()=>{Tt.someTests(M.isAsyncTest)&&zt(),function(){const[t]=J();n.callEach(t)}()})),e(jt.RESET_FIELD,(t=>{Tt.resetField(t)})),e(jt.SUITE_RUN_STARTED,(()=>{tt()})),e(jt.SUITE_CALLBACK_RUN_FINISHED,(()=>{zt()})),e(jt.REMOVE_FIELD,(t=>{Tt.removeTestByFieldName(t)})),e(jt.RESET_SUITE,(()=>{tt(),s.VestRuntime.reset()})),{subscribe:function(e){return t.on("*",(()=>{e()})).off}};function e(e,n){t.on(e,((...t)=>{$(),n(...t)}))}}function Qt(){return Object.freeze(n.assign({done:s.VestRuntime.persist(Zt)},ht()))}function Zt(...t){const[e,s]=t.reverse(),i=Qt();if(function(t,e,s){var i,r;return!!(!n.isFunction(t)||e&&n.numberEquals(null!==(r=null===(i=s.tests[e])||void 0===i?void 0:i.testCount)&&void 0!==r?r:0,0))}(e,s,i))return i;const r=()=>e(ht());return gt.hasRemainingWithTestNameMatching(s)?(function(t,e){const[,s]=Q(),[,i]=J();e?s((s=>n.assign(s,{[e]:(s[e]||[]).concat(t)}))):i((e=>e.concat(t)))}(r,s),i):(r(),i)}function $t(...t){const[e,i]=t.reverse();!function(t){n.invariant(n.isFunction(t),p.SUITE_MUST_BE_INITIALIZED_WITH_FUNCTION)}(e);const r=function({suiteName:t,VestReconciler:e}){const i={doneCallbacks:n.tinyState.createTinyState((()=>[])),fieldCallbacks:n.tinyState.createTinyState((()=>({}))),suiteId:n.seq(),suiteName:t,suiteResultCache:Y};return s.VestRuntime.createRef(e,i)}({suiteName:i,VestReconciler:kt});function a(...t){return T.run({suiteParams:t},(()=>{return s.Bus.useEmit(jt.SUITE_RUN_STARTED),n=function(t,...e){const n=s.Bus.useEmit();return()=>(t(...e),n(jt.SUITE_CALLBACK_RUN_FINISHED),Qt())}(e,...t),s.Isolate.create(l,n,{optional:{}});var n})).output}const o=te(...t);return s.VestRuntime.Run(r,(()=>{const t=Jt();return n.assign(s.VestRuntime.persist(a),Object.assign(Object.assign({dump:s.VestRuntime.persist((()=>s.VestRuntime.useAvailableRoot())),get:s.VestRuntime.persist(ht),remove:s.Bus.usePrepareEmitter(jt.REMOVE_FIELD),reset:s.Bus.usePrepareEmitter(jt.RESET_SUITE),resetField:s.Bus.usePrepareEmitter(jt.RESET_FIELD),resume:s.VestRuntime.persist(et),runStatic:(...t)=>o(...t),subscribe:t.subscribe},(e=s.VestRuntime.persist(ht),{getError:(...t)=>e().getError(...t),getErrors:(...t)=>e().getErrors(...t),getErrorsByGroup:(...t)=>e().getErrorsByGroup(...t),getWarning:(...t)=>e().getWarning(...t),getWarnings:(...t)=>e().getWarnings(...t),getWarningsByGroup:(...t)=>e().getWarningsByGroup(...t),hasErrors:(...t)=>e().hasErrors(...t),hasErrorsByGroup:(...t)=>e().hasErrorsByGroup(...t),hasWarnings:(...t)=>e().hasWarnings(...t),hasWarningsByGroup:(...t)=>e().hasWarningsByGroup(...t),isPending:(...t)=>e().isPending(...t),isTested:(...t)=>e().isTested(...t),isValid:(...t)=>e().isValid(...t),isValidByGroup:(...t)=>e().isValidByGroup(...t)})),Yt()));var e}))}function te(...t){return n.assign(((...e)=>{const s=$t(...t),i=s(...e);return Object.freeze(n.assign({dump:s.dump},i))}),Object.assign({},Yt()))}const ee=p.WARN_MUST_BE_CALLED_FROM_TEST;Object.defineProperty(t,"enforce",{enumerable:!0,get:function(){return e.enforce}}),t.create=$t,t.each=function(t,e){n.invariant(n.isFunction(e),p.EACH_CALLBACK_MUST_BE_A_FUNCTION),function(t){s.Isolate.create(r,t,{allowReorder:!0})}((()=>{t.forEach(((t,n)=>{e(t,n)}))}))},t.group=Bt,t.include=wt,t.mode=function(t){const[,e]=S();e(t)},t.omitWhen=bt,t.only=x,t.optional=I,t.registerReconciler=function(t){Mt.includes(t)||Mt.push(t)},t.skip=X,t.skipWhen=Ct,t.staticSuite=te,t.suiteSelectors=st,t.test=Ht,t.warn=function(){const t=(e=p.HOOK_CALLED_OUTSIDE,T.useX(e).currentTest);var e;n.invariant(t,ee),M.warn(t)}}));
//# sourceMappingURL=vest.production.js.map
