{"version":3,"file":"debounce.development.js","sources":["../../src/exports/debounce.ts"],"sourcesContent":["import { registerReconciler } from 'vest';\nimport { CB, isPromise, Nullable } from 'vest-utils';\nimport { Isolate, TIsolate, IsolateSelectors } from 'vestjs-runtime';\n\nimport { TestFn, TestFnPayload } from 'TestTypes';\n\nconst isolateType = 'Debounce';\n\nexport default function debounce<Callback extends CB = CB>(\n  callback: Callback,\n  delay: number = 0,\n): TestFn {\n  let timeout: Nullable<NodeJS.Timeout> = null;\n\n  const f = () => (payload: TestFnPayload) =>\n    new Promise((resolve, reject) => {\n      timeout = setTimeout(() => {\n        let res = false;\n        try {\n          res = callback(payload);\n        } catch (e) {\n          return reject(e);\n        }\n\n        if (res === false) {\n          return reject();\n        }\n\n        return isPromise(res) ? res.then(resolve, reject) : resolve(res);\n      }, delay);\n    });\n\n  const i = Isolate.create(isolateType, f, {\n    clearTimeout: () => {\n      if (timeout) {\n        clearTimeout(timeout);\n      }\n    },\n  });\n\n  return i.output;\n}\n\nexport class IsolateDebounceReconciler {\n  static match(currentNode: TIsolate, historyNode: TIsolate): boolean {\n    return (\n      IsolateSelectors.isIsolateType(currentNode, isolateType) &&\n      IsolateSelectors.isIsolateType(historyNode, isolateType)\n    );\n  }\n\n  static reconcile(current: TIsolateDebounce, history: TIsolateDebounce) {\n    history?.data?.clearTimeout?.();\n\n    return current;\n  }\n}\n\nexport type TIsolateDebounce = TIsolate<IsolateDebouncePayload>;\n\nexport type IsolateDebouncePayload = {\n  clearTimeout: () => void;\n};\n\nregisterReconciler(IsolateDebounceReconciler);\n"],"names":["isPromise","Isolate","IsolateSelectors","registerReconciler"],"mappings":";;;;;;EAMA,MAAM,WAAW,GAAG,UAAU,CAAC;EAEP,SAAA,QAAQ,CAC9B,QAAkB,EAClB,QAAgB,CAAC,EAAA;MAEjB,IAAI,OAAO,GAA6B,IAAI,CAAC;EAE7C,IAAA,MAAM,CAAC,GAAG,MAAM,CAAC,OAAsB,KACrC,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAI;EAC9B,QAAA,OAAO,GAAG,UAAU,CAAC,MAAK;cACxB,IAAI,GAAG,GAAG,KAAK,CAAC;cAChB,IAAI;EACF,gBAAA,GAAG,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC;EACzB,aAAA;EAAC,YAAA,OAAO,CAAC,EAAE;EACV,gBAAA,OAAO,MAAM,CAAC,CAAC,CAAC,CAAC;EAClB,aAAA;cAED,IAAI,GAAG,KAAK,KAAK,EAAE;kBACjB,OAAO,MAAM,EAAE,CAAC;EACjB,aAAA;cAED,OAAOA,mBAAS,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,OAAO,EAAE,MAAM,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC;WAClE,EAAE,KAAK,CAAC,CAAC;EACZ,KAAC,CAAC,CAAC;MAEL,MAAM,CAAC,GAAGC,qBAAO,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,EAAE;UACvC,YAAY,EAAE,MAAK;EACjB,YAAA,IAAI,OAAO,EAAE;kBACX,YAAY,CAAC,OAAO,CAAC,CAAC;EACvB,aAAA;WACF;EACF,KAAA,CAAC,CAAC;MAEH,OAAO,CAAC,CAAC,MAAM,CAAC;EAClB,CAAC;QAEY,yBAAyB,CAAA;EACpC,IAAA,OAAO,KAAK,CAAC,WAAqB,EAAE,WAAqB,EAAA;UACvD,QACEC,8BAAgB,CAAC,aAAa,CAAC,WAAW,EAAE,WAAW,CAAC;cACxDA,8BAAgB,CAAC,aAAa,CAAC,WAAW,EAAE,WAAW,CAAC,EACxD;OACH;EAED,IAAA,OAAO,SAAS,CAAC,OAAyB,EAAE,OAAyB,EAAA;;UACnE,CAAA,EAAA,GAAA,CAAA,EAAA,GAAA,OAAO,KAAA,IAAA,IAAP,OAAO,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAP,OAAO,CAAE,IAAI,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAE,YAAY,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,CAAA,EAAA,CAAI,CAAC;EAEhC,QAAA,OAAO,OAAO,CAAC;OAChB;EACF,CAAA;AAQDC,yBAAkB,CAAC,yBAAyB,CAAC;;;;;;;;;;;"}