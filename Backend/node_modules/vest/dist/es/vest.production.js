import{enforce as t}from"n4s";export{enforce}from"n4s";import{assign as e,tinyState as n,cache as s,isArray as i,isStringValue as r,asArray as a,hasOwnProperty as o,StateMachine as u,invariant as c,isPromise as l,optionalFunctionValue as E,noop as d,isNotEmpty as f,seq as N,isPositive as T,greaterThan as S,Predicates as g,isNullish as I,bindNot as R,either as _,defaultTo as D,isNotNullish as O,deferThrow as m,text as p,isUndefined as A,isNull as v,isFunction as C,isEmpty as h,callEach as P,numberEquals as L}from"vest-utils";import{Isolate as U,VestRuntime as F,IsolateSelectors as G,IsolateMutator as b,Walker as y,IsolateInspector as W,Reconciler as M,Bus as w,RuntimeEvents as B}from"vestjs-runtime";import{createCascade as k}from"context";const j="Each",K="Focused",V="Group",X="OmitWhen",x="SkipWhen",H="Suite",q="Test";class Y{static setOptionalField(t,n,s){const i=t.data.optional,r=i[n];e(i,{[n]:e({},r,s(r))})}static getOptionalField(t,e){var n;return null!==(n=Y.getOptionalFields(t)[e])&&void 0!==n?n:{}}static getOptionalFields(t){var e,n;return null!==(n=null===(e=t.data)||void 0===e?void 0:e.optional)&&void 0!==n?n:{}}}var z,J;!function(t){t[t.CUSTOM_LOGIC=0]="CUSTOM_LOGIC",t[t.AUTO=1]="AUTO"}(z||(z={})),function(t){t.EAGER="EAGER",t.ALL="ALL",t.ONE="ONE"}(J||(J={}));const Q=k(((t,s)=>s?null:e({inclusion:{},mode:n.createTinyState(J.EAGER),suiteParams:[],testMemoCache:tt},t)));function Z(){return Q.useX().inclusion}function $(){return Q.useX().mode()}const tt=s(10);function et(e){var n;const s=F.useAvailableRoot(),u=Q.useX().suiteParams,c=null!==(n=null==u?void 0:u[0])&&void 0!==n?n:{};if(i(e)||r(e))a(e).forEach((e=>{Y.setOptionalField(s,e,(()=>({type:z.AUTO,applied:!!o(c,e)&&t.isBlank().test(null==c?void 0:c[e]),rule:null})))}));else for(const n in e){const i=e[n];Y.setOptionalField(s,n,(()=>({type:z.CUSTOM_LOGIC,rule:i,applied:t.isBlank().test(i)||!0===i})))}}function nt(t){var e,n;if(!t)return!1;const s=F.useAvailableRoot();return null!==(n=null===(e=Y.getOptionalField(s,t))||void 0===e?void 0:e.applied)&&void 0!==n&&n}var st;!function(t){t.HOOK_CALLED_OUTSIDE="hook called outside of a running suite.",t.EXPECTED_VEST_TEST="Expected value to be an instance of IsolateTest",t.FIELD_NAME_REQUIRED="Field name must be passed",t.SUITE_MUST_BE_INITIALIZED_WITH_FUNCTION="Suite must be initialized with a function",t.PROMISIFY_REQUIRE_FUNCTION="Vest.Promisify must be called with a function",t.PARSER_EXPECT_RESULT_OBJECT="Vest parser: expected argument at position 0 to be Vest's result object.",t.WARN_MUST_BE_CALLED_FROM_TEST="Warn must be called from within the body of a test function",t.EACH_CALLBACK_MUST_BE_A_FUNCTION="Each must be called with a function",t.INVALID_PARAM_PASSED_TO_FUNCTION='Incompatible params passed to {fn_name} function. "{param}" must be of type {expected}',t.TESTS_CALLED_IN_DIFFERENT_ORDER='Vest Critical Error: Tests called in different order than previous run.\n    expected: {fieldName}\n    received: {prevName}\n    This can happen on one of two reasons:\n    1. You\'re using if/else statements to conditionally select tests. Instead, use "skipWhen".\n    2. You are iterating over a list of tests, and their order changed. Use "each" and a custom key prop so that Vest retains their state.',t.UNEXPECTED_TEST_REGISTRATION_ERROR="Unexpected error encountered during test registration.\n      Please report this issue to Vest's Github repository.\n      Test Object: {testObject}.\n      Error: {error}.",t.UNEXPECTED_TEST_RUN_ERROR="Unexpected error encountered during test run. Please report this issue to Vest's Github repository.\n      Test Object: {testObject}.",t.INCLUDE_SELF="Trying to call include.when on the same field."}(st||(st={}));const it="PENDING",rt="INITIAL",at={[it]:it,[rt]:rt,DONE:"DONE"};function ot(t,e){return ut.staticTransition(null!=t?t:at.INITIAL,e)}const ut=u({initial:at.INITIAL,states:{[at.DONE]:{},[at.INITIAL]:{[at.PENDING]:at.PENDING,[at.DONE]:at.DONE},[at.PENDING]:{[at.DONE]:at.DONE}}}),ct={[it]:it,CANCELED:"CANCELED",FAILED:"FAILED",OMITTED:"OMITTED",PASSING:"PASSING",SKIPPED:"SKIPPED",UNTESTED:"UNTESTED",WARNING:"WARNING"},lt="RESET",Et=u({initial:ct.UNTESTED,states:{"*":{[ct.OMITTED]:ct.OMITTED,[lt]:ct.UNTESTED},[ct.UNTESTED]:{[ct.CANCELED]:ct.CANCELED,[ct.FAILED]:ct.FAILED,[ct.PASSING]:ct.PASSING,[ct.PENDING]:ct.PENDING,[ct.SKIPPED]:ct.SKIPPED,[ct.WARNING]:ct.WARNING},[ct.PENDING]:{[ct.CANCELED]:ct.CANCELED,[ct.FAILED]:ct.FAILED,[ct.PASSING]:ct.PASSING,[ct.SKIPPED]:[ct.SKIPPED,t=>!0===t],[ct.WARNING]:ct.WARNING},[ct.SKIPPED]:{},[ct.FAILED]:{},[ct.WARNING]:{},[ct.PASSING]:{},[ct.CANCELED]:{},[ct.OMITTED]:{}}});var dt,ft,Nt,Tt;function St(t){return t===dt.ERRORS?ft.ERROR_COUNT:ft.WARN_COUNT}!function(t){t.WARNINGS="warnings",t.ERRORS="errors"}(dt||(dt={})),function(t){t.ERROR_COUNT="errorCount",t.WARN_COUNT="warnCount"}(ft||(ft={})),function(t){t.Error="error",t.Warning="warning"}(Nt||(Nt={}));class gt{static getStatus(t){var e;return null!==(e=t.status)&&void 0!==e?e:rt}static setStatus(t,e,n){t.status=this.stateMachine.staticTransition(gt.getStatus(t),e,n)}static statusEquals(t,e){return gt.getStatus(t)===e}static setPending(t){this.setStatus(t,it)}static isPending(t){return gt.statusEquals(t,it)}}gt.stateMachine=ut;class It extends gt{static getData(t){return c(t.data),t.data}static is(t){return G.isIsolateType(t,q)}static isX(t){c(It.is(t),st.EXPECTED_VEST_TEST)}static cast(t){return It.isX(t),t}static warns(t){return It.getData(t).severity===Nt.Warning}static isOmitted(t){return It.statusEquals(t,ct.OMITTED)}static isUntested(t){return It.statusEquals(t,ct.UNTESTED)}static isFailing(t){return It.statusEquals(t,ct.FAILED)}static isCanceled(t){return It.statusEquals(t,ct.CANCELED)}static isSkipped(t){return It.statusEquals(t,ct.SKIPPED)}static isPassing(t){return It.statusEquals(t,ct.PASSING)}static isWarning(t){return It.statusEquals(t,ct.WARNING)}static hasFailures(t){return It.isFailing(t)||It.isWarning(t)}static isNonActionable(t){return It.isSkipped(t)||It.isOmitted(t)||It.isCanceled(t)}static isTested(t){return It.hasFailures(t)||It.isPassing(t)}static awaitsResolution(t){return It.isSkipped(t)||It.isUntested(t)||It.isPending(t)}static isAsyncTest(t){return l(It.getData(t).asyncTest)}static fail(t){It.setStatus(t,It.warns(t)?ct.WARNING:ct.FAILED)}static pass(t){It.setStatus(t,ct.PASSING)}static warn(t){It.setData(t,(t=>Object.assign(Object.assign({},t),{severity:Nt.Warning})))}static setData(t,e){t.data=E(e,It.getData(t))}static skip(t,e){It.setStatus(t,ct.SKIPPED,e)}static cancel(t){It.setStatus(t,ct.CANCELED),b.abort(t,ct.CANCELED)}static omit(t){It.setStatus(t,ct.OMITTED)}static reset(t){It.setStatus(t,lt)}}function Rt(t,e){return!!e&&!_t(t,e)}function _t(t,e){return!(!e||t.fieldName!==e)}function Dt(t,e){const{groupName:n}=It.getData(t),{groupName:s,fieldName:i}=It.getData(e);return _t(It.getData(t),i)&&n===s&&t.key==e.key}function Ot(t,e){return U.create(K,d,{focusMode:t,match:a(e).filter(r),matchAll:!0===e})}It.stateMachine=Et,function(t){t[t.ONLY=0]="ONLY",t[t.SKIP=1]="SKIP"}(Tt||(Tt={}));class mt{static isSkipFocused(t,e){return(null==t?void 0:t.data.focusMode)===Tt.SKIP&&(Ct(t,e)||!0===t.data.matchAll)}static isOnlyFocused(t,e){return(null==t?void 0:t.data.focusMode)===Tt.ONLY&&Ct(t,e)}static isIsolateFocused(t){return G.isIsolateType(t,K)}}function pt(t){return Ot(Tt.ONLY,vt(t))}function At(t){return Ot(Tt.SKIP,vt(t))}function vt(t){return!1===t?[]:t}function Ct(t,e){var n,s;return f(null==t?void 0:t.data.match)&&(!e||(null===(s=null===(n=null==t?void 0:t.data.match)||void 0===n?void 0:n.includes(e))||void 0===s||s))}const ht=s();function Pt(){return F.useXAppData()}function Lt(){return Pt().doneCallbacks()}function Ut(){return Pt().fieldCallbacks()}function Ft(){return Pt().suiteId}function Gt(){Pt().suiteResultCache.invalidate([Ft()])}function bt(){const[,,t]=Lt(),[,,e]=Ut();t(),e()}function yt(t){F.useLoadRootNode(t),Gt()}function Wt(t,e,n){return n?function(t,e,n){var s;return(null===(s=null==t?void 0:t[n])||void 0===s?void 0:s[e])||[]}(t,e,n):function(t,e){const n={},s=St(e);for(const i in t)T(t[i][s])&&(n[i]=t[i][e]||[]);return n}(t,e)}function Mt(t){const e={getError:function(e){return Vt(dt.ERRORS,t,e)},getErrors:function(e){return wt(t,dt.ERRORS,e)},getErrorsByGroup:function(e,n){return Bt(t,dt.ERRORS,e,n)},getWarning:function(e){return Vt(dt.WARNINGS,t,e)},getWarnings:function(e){return wt(t,dt.WARNINGS,e)},getWarningsByGroup:function(e,n){return Bt(t,dt.WARNINGS,e,n)},hasErrors:function(e){return Kt(t,ft.ERROR_COUNT,e)},hasErrorsByGroup:function(e,n){return jt(t,ft.ERROR_COUNT,e,n)},hasWarnings:function(e){return Kt(t,ft.WARN_COUNT,e)},hasWarningsByGroup:function(e,n){return jt(t,ft.WARN_COUNT,e,n)},isPending:function(e){var n;return S(e?null===(n=t.tests[e])||void 0===n?void 0:n.pendingCount:t.pendingCount,0)},isTested:function(e){var n;return T(null===(n=t.tests[e])||void 0===n?void 0:n.testCount)},isValid:function(e){var n;return e?Boolean(null===(n=t.tests[e])||void 0===n?void 0:n.valid):t.valid},isValidByGroup:function(e,n){const s=t.groups[e];if(!s)return!1;if(n)return kt(s,n);for(const t in s)if(!kt(s,t))return!1;return!0}};return e}function wt(t,e,n){return Wt(t.tests,e,n)}function Bt(t,e,n,s){return Wt(t.groups[n],e,s)}function kt(t,e){var n;return!!(null===(n=t[e])||void 0===n?void 0:n.valid)}function jt(t,e,n,s){var i,r;const a=t.groups[n];if(!a)return!1;if(s)return T(null===(i=a[s])||void 0===i?void 0:i[e]);for(const t in a)if(T(null===(r=a[t])||void 0===r?void 0:r[e]))return!0;return!1}function Kt(t,e,n){var s;const i=n?null===(s=t.tests[n])||void 0===s?void 0:s[e]:t[e]||0;return T(i)}function Vt(t,e,n){var s;const i=e[t];return n?null===(s=i.find((t=>_t(t,n))))||void 0===s?void 0:s.message:i[0]}var Xt,xt;class Ht{constructor(){this.errorCount=0,this.warnCount=0,this.testCount=0,this.pendingCount=0}}class qt extends Ht{constructor(){super(...arguments),this[Xt]=[],this[xt]=[],this.groups={},this.tests={},this.valid=!1}}Xt=dt.ERRORS,xt=dt.WARNINGS;class Yt{constructor(t,e,n){this.fieldName=t,this.message=e,this.groupName=n}static fromTestObject(t){const{fieldName:e,message:n,groupName:s}=It.getData(t);return new Yt(e,n,s)}}class zt{static hasNoTests(t=zt.defaultRoot()){return!t||!y.has(t,It.is)}static someTests(t,e=zt.defaultRoot()){return!!e&&y.some(e,(e=>(It.isX(e),t(e))),It.is)}static everyTest(t,e=zt.defaultRoot()){return!!e&&y.every(e,(e=>(It.isX(e),t(e))),It.is)}static walkTests(t,e=zt.defaultRoot()){e&&y.walk(e,((e,n)=>{t(It.cast(e),n)}),It.is)}static pluckTests(t,e=zt.defaultRoot()){e&&y.pluck(e,(e=>(It.isX(e),t(e))),It.is)}static resetField(t){zt.walkTests((e=>{_t(It.getData(e),t)&&It.reset(e)}),zt.defaultRoot())}static removeTestByFieldName(t,e=zt.defaultRoot()){zt.pluckTests((e=>_t(It.getData(e),t)),e)}}zt.defaultRoot=F.useAvailableRoot;class Jt{static hasPending(t){const e=Jt.defaultRoot();return!!e&&y.some(e,g.all(gt.isPending,null==t||t))}static hasRemainingWithTestNameMatching(t){return Jt.hasPending(g.any(I(t),g.all(It.is,(e=>function(t,e){return!e||_t(t,e)}(It.getData(e),t)))))}}Jt.defaultRoot=F.useAvailableRoot;const Qt=R((function(t,e){return It.getData(t).groupName===e}));function Zt(t){return function(t,e){return zt.someTests((n=>$t(n,t,e)))}(dt.ERRORS,t)}function $t(t,e,n){return!!It.hasFailures(t)&&(!Rt(It.getData(t),n)&&!function(t,e){return _(t===dt.WARNINGS,It.warns(e))}(e,t))}function te(t){return!!nt(t)||!zt.hasNoTests()&&(!Zt(t)&&(!function(t){return Jt.hasPending(g.all(It.is,(e=>!Rt(It.getData(e),t)),(()=>!nt(t))))}(t)&&function(t){return zt.everyTest((e=>ne(e,t)))}(t)))}function ee(t,e){return!!nt(e)||!function(t,e,n){return zt.someTests((s=>!Qt(s,e)&&$t(s,t,n)))}(dt.ERRORS,t,e)&&(!function(t,e){return Jt.hasPending(g.all(It.is,(e=>!Qt(e,t)),(t=>!Rt(It.getData(t),e)),(()=>!nt(e))))}(t,e)&&function(t,e){return zt.everyTest((n=>!!Qt(n,t)||ne(n,e)))}(t,e))}function ne(t,e){return!!Rt(It.getData(t),e)||(It.isOmitted(t)||It.isTested(t)||function(t){const e=F.useAvailableRoot(),{fieldName:n}=It.getData(t);return Y.getOptionalField(e,n).type===z.AUTO&&It.awaitsResolution(t)}(t))}function se(){const t=new qt;return zt.walkTests((e=>{t.tests=function(t,e){const n=It.getData(e).fieldName,s=Object.assign({},t);return s[n]=re(s[n],e),s[n].valid=!1!==s[n].valid&&te(n),s}(t.tests,e),t.groups=function(t,e){const{groupName:n,fieldName:s}=It.getData(e);if(!n)return t;const i=Object.assign({},t);return i[n]=i[n]||{},i[n][s]=re(i[n][s],e),i[n][s].valid=!1!==i[n][s].valid&&ee(n,s),i}(t.groups,e),t.errors=ie(dt.ERRORS,t.errors,e),t.warnings=ie(dt.WARNINGS,t.warnings,e)})),t.valid=te(),function(t){for(const e in t.tests)t.errorCount+=t.tests[e].errorCount,t.warnCount+=t.tests[e].warnCount,t.testCount+=t.tests[e].testCount,t.pendingCount+=t.tests[e].pendingCount;return t}(t)}function ie(t,e,n){if(It.isOmitted(n))return e;return(t===dt.WARNINGS?It.isWarning(n):It.isFailing(n))?e.concat(Yt.fromTestObject(n)):e}function re(t,e){const{message:n}=It.getData(e),s=D(t?Object.assign({},t):null,ae);return It.isNonActionable(e)||(It.isPending(e)&&s.pendingCount++,It.isFailing(e)?i(dt.ERRORS):It.isWarning(e)&&i(dt.WARNINGS),s.testCount++),s;function i(t){const e=St(t);s[e]++,n&&(s[t]=(s[t]||[]).concat(n))}}function ae(){return e(new Ht,{errors:[],valid:!0,warnings:[]})}function oe(){return t=()=>{const t=se(),n=Pt().suiteName;return Object.freeze(e(t,Mt(t),{suiteName:n}))},(0,Pt().suiteResultCache)([Ft()],t);var t}function ue(t,e){U.create(x,(()=>{Q.run({skipped:ce()||E(t,E(oe))},e)}))}function ce(){return function(){var t;return null!==(t=Q.useX().skipped)&&void 0!==t&&t}()}function le(t,e){return O(y.findClosest(t,(t=>!!mt.isIsolateFocused(t)&&mt.isOnlyFocused(t,e))))}function Ee(t){const{fieldName:e}=It.getData(t);if(ce())return!0;const n=Z(),s=function(t){return y.findClosest(t,(e=>{var n;if(!mt.isIsolateFocused(e))return!1;const{fieldName:s}=It.getData(t);return(null===(n=e.data.match)||void 0===n?void 0:n.includes(s))||e.data.matchAll}))}(t);if(mt.isSkipFocused(s))return!0;return!mt.isOnlyFocused(s)&&(!!le(t)&&!E(n[e],t))}function de(t){const[,e]=$();e(t)}function fe(t){const[e]=$();return e===t}function Ne(t){return fe(J.ONE)?Zt():!!fe(J.EAGER)&&Zt(t.fieldName)}function Te(t,e){U.create(X,(()=>{Q.run({omitted:Se()||E(t,E(oe))},e)}))}function Se(){return function(){var t;return null!==(t=Q.useX().omitted)&&void 0!==t&&t}()}function ge(t,e=t){const n=It.getData(t);return Ne(n)?(s=t,It.skip(s),s):(i=n.fieldName,Se()||nt(i)?function(t){return It.omit(t),t}(t):Ee(t)?function(t){return It.skip(t,ce()),t}(e):t);var s,i}function Ie(t,e){return It.is(e)&&!Dt(e,t)}const Re=[class{static match(t,e){return It.is(t)&&It.is(e)}static reconcile(t,e){const n=ge(t,function(t,e){if(W.usesKey(t))return function(t){return It.cast(M.handleIsolateNodeWithKey(t,(e=>!!It.isNonActionable(e)||!Ee(t))))}(t);if(M.dropNextNodesOnReorder(Ie,t,e))return function(t,e){if(W.canReorder(t))return;m(p(st.TESTS_CALLED_IN_DIFFERENT_ORDER,{fieldName:It.getData(t).fieldName,prevName:It.is(e)?It.getData(e).fieldName:void 0}))}(t,e),t;if(!It.is(e))return t;if(It.isOmitted(e))return t;return e}(t,e));return function(t,e,n){t===e&&It.is(e)&&(i=e)!==(s=n)&&Dt(s,i)&&It.isPending(s)&&It.cancel(s);var s,i}(n,t,e),n}}];function _e(t){Re.includes(t)||Re.push(t)}function De(t,e){var n,s;return null!==(s=null===(n=Re.find((n=>n.match(t,e))))||void 0===n?void 0:n.reconcile(t,e))&&void 0!==s?s:null}function Oe(...t){const[e,n]=t.reverse();return U.create(V,(()=>Q.run(Object.assign({},n&&{groupName:n}),e)))}function me(t){c(r(t));return Z()[t]=!0,{when:function(e){c(e!==t,st.INCLUDE_SELF);Z()[t]=function(t){return r(e)?le(t,e):E(e,E(oe))}}}}var pe;function Ae(t,e,n){const s=Object.assign(Object.assign({},{severity:Nt.Error,status:Et.initial()}),{fieldName:e.fieldName,testFn:e.testFn});e.groupName&&(s.groupName=e.groupName),e.message&&(s.message=e.message);return U.create(q,t,s,null!=n?n:null)}function ve(t){if(ge(t),It.isUntested(t))return function(t){const e=function(t){return Q.run({currentTest:t},(()=>{let e;const{message:n,testFn:s}=It.getData(t);try{e=s({signal:t.abortController.signal})}catch(s){(function(t,e){return A(t)&&r(e)})(n,s)&&(It.getData(t).message=s),e=!1}return!1===e&&It.fail(t),e}))}(t);try{if(l(e))return It.getData(t).asyncTest=e,function(t){const{asyncTest:e,message:n}=It.getData(t);if(!l(e))return;const s=F.persist((()=>{Ce(t)})),i=F.persist((e=>{It.isCanceled(t)||(It.getData(t).message=r(e)?e:n,It.fail(t),s())}));return e.then(s,i)}(t);Ce(t)}catch(e){throw new Error(p(st.UNEXPECTED_TEST_REGISTRATION_ERROR,{testObject:JSON.stringify(t),error:e}))}}(t);It.isNonActionable(t)||m(p(st.UNEXPECTED_TEST_REGISTRATION_ERROR,{testObject:JSON.stringify(t)}))}function Ce(t){It.pass(t)}function he(t,...e){const[n,s,i]=C(e[1])?e:[void 0,...e];!function(t,e){const n="test";c(r(t),p(st.INVALID_PARAM_PASSED_TO_FUNCTION,{fn_name:n,param:"fieldName",expected:"string"})),c(C(e),p(st.INVALID_PARAM_PASSED_TO_FUNCTION,{fn_name:n,param:"callback",expected:"function"}))}(t,s);const a={fieldName:t,groupName:Q.useX().groupName,message:n,testFn:s};return w.useEmit(pe.TEST_RUN_STARTED),Ae(ve,a,i)}!function(t){t.TEST_RUN_STARTED="test_run_started",t.TEST_COMPLETED="test_completed",t.ALL_RUNNING_TESTS_FINISHED="all_running_tests_finished",t.REMOVE_FIELD="remove_field",t.RESET_FIELD="reset_field",t.RESET_SUITE="reset_suite",t.SUITE_RUN_STARTED="suite_run_started",t.SUITE_CALLBACK_RUN_FINISHED="SUITE_CALLBACK_RUN_FINISHED",t.DONE_TEST_OMISSION_PASS="DONE_TEST_OMISSION_PASS"}(pe||(pe={}));const Pe=e(he,{memo:function(t){return function(e,...n){const[s,i,r]=n.reverse();return function(t,e){const n=Q.useX().testMemoCache,s=n.get(t);if(v(s))return n(t,e);const[,i]=s;if(It.isCanceled(i))return n.invalidate(t),n(t,e);return F.addNodeToHistory(i),i}([Ft(),e,F.useCurrentCursor()].concat(s),(function(){return t(e,r,i)}))}}(he)});function Le(){return{group:Oe,include:me,omitWhen:Te,only:pt,optional:et,skip:At,skipWhen:ue,test:Pe}}function Ue(){const t=F.useAvailableRoot(),e=Y.getOptionalFields(t);if(h(e))return;const n=new Set;function s(e){const{fieldName:s}=It.getData(e);n.has(s)&&(It.omit(e),Y.setOptionalField(t,s,(t=>Object.assign(Object.assign({},t),{applied:!0}))))}zt.walkTests((e=>{if(It.isPending(e))return;const{fieldName:i}=It.getData(e);n.has(i)?s(e):function(e){const{fieldName:i}=It.getData(e),r=Y.getOptionalField(t,i);!0===E(r.rule)&&n.add(i);s(e)}(e)})),w.useEmit(pe.DONE_TEST_OMISSION_PASS)}function Fe(){const t=w.useBus();return e(pe.TEST_COMPLETED,(t=>{if(It.isCanceled(t))return;const{fieldName:e}=It.getData(t);!function(t){const[e]=Ut();t&&!Jt.hasRemainingWithTestNameMatching(t)&&i(e[t])&&P(e[t])}(e)})),e(pe.TEST_RUN_STARTED,(()=>{})),e(B.ISOLATE_PENDING,(t=>{It.is(t)&&It.setPending(t),function(t){t.status=ot(t.status,at.PENDING)}(t)})),e(B.ISOLATE_DONE,(e=>{It.is(e)&&t.emit(pe.TEST_COMPLETED,e),function(t){t.status=ot(t.status,at.DONE)}(e),Jt.hasPending()||t.emit(pe.ALL_RUNNING_TESTS_FINISHED)})),e(pe.DONE_TEST_OMISSION_PASS,(()=>{})),e(pe.ALL_RUNNING_TESTS_FINISHED,(()=>{zt.someTests(It.isAsyncTest)&&Ue(),function(){const[t]=Lt();P(t)}()})),e(pe.RESET_FIELD,(t=>{zt.resetField(t)})),e(pe.SUITE_RUN_STARTED,(()=>{bt()})),e(pe.SUITE_CALLBACK_RUN_FINISHED,(()=>{Ue()})),e(pe.REMOVE_FIELD,(t=>{zt.removeTestByFieldName(t)})),e(pe.RESET_SUITE,(()=>{bt(),F.reset()})),{subscribe:function(e){return t.on("*",(()=>{e()})).off}};function e(e,n){t.on(e,((...t)=>{Gt(),n(...t)}))}}function Ge(){return Object.freeze(e({done:F.persist(be)},oe()))}function be(...t){const[n,s]=t.reverse(),i=Ge();if(function(t,e,n){var s,i;return!!(!C(t)||e&&L(null!==(i=null===(s=n.tests[e])||void 0===s?void 0:s.testCount)&&void 0!==i?i:0,0))}(n,s,i))return i;const r=()=>n(oe());return Jt.hasRemainingWithTestNameMatching(s)?(function(t,n){const[,s]=Ut(),[,i]=Lt();n?s((s=>e(s,{[n]:(s[n]||[]).concat(t)}))):i((e=>e.concat(t)))}(r,s),i):(r(),i)}function ye(...t){const[s,i]=t.reverse();!function(t){c(C(t),st.SUITE_MUST_BE_INITIALIZED_WITH_FUNCTION)}(s);const r=function({suiteName:t,VestReconciler:e}){const s={doneCallbacks:n.createTinyState((()=>[])),fieldCallbacks:n.createTinyState((()=>({}))),suiteId:N(),suiteName:t,suiteResultCache:ht};return F.createRef(e,s)}({suiteName:i,VestReconciler:De});function a(...t){return Q.run({suiteParams:t},(()=>{return w.useEmit(pe.SUITE_RUN_STARTED),e=function(t,...e){const n=w.useEmit();return()=>(t(...e),n(pe.SUITE_CALLBACK_RUN_FINISHED),Ge())}(s,...t),U.create(H,e,{optional:{}});var e})).output}const o=We(...t);return F.Run(r,(()=>{const t=Fe();return e(F.persist(a),Object.assign(Object.assign({dump:F.persist((()=>F.useAvailableRoot())),get:F.persist(oe),remove:w.usePrepareEmitter(pe.REMOVE_FIELD),reset:w.usePrepareEmitter(pe.RESET_SUITE),resetField:w.usePrepareEmitter(pe.RESET_FIELD),resume:F.persist(yt),runStatic:(...t)=>o(...t),subscribe:t.subscribe},(n=F.persist(oe),{getError:(...t)=>n().getError(...t),getErrors:(...t)=>n().getErrors(...t),getErrorsByGroup:(...t)=>n().getErrorsByGroup(...t),getWarning:(...t)=>n().getWarning(...t),getWarnings:(...t)=>n().getWarnings(...t),getWarningsByGroup:(...t)=>n().getWarningsByGroup(...t),hasErrors:(...t)=>n().hasErrors(...t),hasErrorsByGroup:(...t)=>n().hasErrorsByGroup(...t),hasWarnings:(...t)=>n().hasWarnings(...t),hasWarningsByGroup:(...t)=>n().hasWarningsByGroup(...t),isPending:(...t)=>n().isPending(...t),isTested:(...t)=>n().isTested(...t),isValid:(...t)=>n().isValid(...t),isValidByGroup:(...t)=>n().isValidByGroup(...t)})),Le()));var n}))}function We(...t){return e(((...n)=>{const s=ye(...t),i=s(...n);return Object.freeze(e({dump:s.dump},i))}),Object.assign({},Le()))}function Me(t,e){c(C(e),st.EACH_CALLBACK_MUST_BE_A_FUNCTION),function(t){U.create(j,t,{allowReorder:!0})}((()=>{t.forEach(((t,n)=>{e(t,n)}))}))}const we=st.WARN_MUST_BE_CALLED_FROM_TEST;function Be(){const t=(e=st.HOOK_CALLED_OUTSIDE,Q.useX(e).currentTest);var e;c(t,we),It.warn(t)}export{J as Modes,ye as create,Me as each,Oe as group,me as include,de as mode,Te as omitWhen,pt as only,et as optional,_e as registerReconciler,At as skip,ue as skipWhen,We as staticSuite,Mt as suiteSelectors,Pe as test,Be as warn};
//# sourceMappingURL=vest.production.js.map
