import{invariant as t,isNullish as e,isStringValue as r,hasOwnProperty as s,text as i}from"vest-utils";import{expandObject as a,minifyObject as n}from"vest-utils/minifyObject";var o,l;!function(t){t.NO_ACTIVE_ISOLATE="Not within an active isolate",t.UNABLE_TO_PICK_NEXT_ISOLATE="Unable to pick next isolate. This is a bug, please report it to the Vest maintainers.",t.ENCOUNTERED_THE_SAME_KEY_TWICE='Encountered the same key "{key}" twice. This may lead to inconsistent or overriding of results.',t.INVALID_ISOLATE_CANNOT_PARSE="Invalid isolate was passed to IsolateSerializer. Cannot proceed."}(o||(o={})),function(t){t.Type="$type",t.Keys="keys",t.Key="key",t.Parent="parent",t.Data="data",t.AllowReorder="allowReorder",t.Status="status",t.AbortController="abortController",t.Children="children"}(l||(l={}));const c=new Set([l.AbortController,l.Parent,l.Keys]);class d{static setParent(t,e){return t.parent=e,t}static saveOutput(t,e){return t.output=e,t}static setKey(t,e){return t.key=e,t}static addChild(e,r){var s;t(e),e.children=null!==(s=e.children)&&void 0!==s?s:[],e.children.push(r),d.setParent(r,e)}static removeChild(t,e){var r,s;t.children=null!==(s=null===(r=t.children)||void 0===r?void 0:r.filter((t=>t!==e)))&&void 0!==s?s:null}static addChildKey(e,r,s){var i;t(e),e.keys=null!==(i=e.keys)&&void 0!==i?i:{},e.keys[r]=s}static slice(t,r){e(t.children)||(t.children.length=r)}static setData(t,e){t.data=e}static abort(t,r){e(t.abortController)||t.abortController.abort(r)}}class u{static deserialize(t){const e=r(t)?JSON.parse(t):Object.assign({},t),s=a(...e);u.validateIsolate(s);const i=[s];for(;i.length;){const t=i.shift();if(!t)continue;const e=t.children;e&&(t.children=e.map((e=>{var r;const s=Object.assign({},e);d.setParent(s,t),i.push(s);const a=s.key;return a&&(t.keys=null!==(r=t.keys)&&void 0!==r?r:{},t.keys[a]=s),s})))}return s}static serialize(t){if(e(t))return"";const r=n(t,c);return JSON.stringify(r)}static validateIsolate(e){t(s(e,l.Type),i(o.INVALID_ISOLATE_CANNOT_PARSE))}}export{u as IsolateSerializer};
//# sourceMappingURL=IsolateSerializer.production.js.map
