"use strict";var t,e,i=require("vest-utils"),r=require("vest-utils/minifyObject");!function(t){t.NO_ACTIVE_ISOLATE="Not within an active isolate",t.UNABLE_TO_PICK_NEXT_ISOLATE="Unable to pick next isolate. This is a bug, please report it to the Vest maintainers.",t.ENCOUNTERED_THE_SAME_KEY_TWICE='Encountered the same key "{key}" twice. This may lead to inconsistent or overriding of results.',t.INVALID_ISOLATE_CANNOT_PARSE="Invalid isolate was passed to IsolateSerializer. Cannot proceed."}(t||(t={})),function(t){t.Type="$type",t.Keys="keys",t.Key="key",t.Parent="parent",t.Data="data",t.AllowReorder="allowReorder",t.Status="status",t.AbortController="abortController",t.Children="children"}(e||(e={}));const s=new Set([e.AbortController,e.Parent,e.Keys]);class a{static setParent(t,e){return t.parent=e,t}static saveOutput(t,e){return t.output=e,t}static setKey(t,e){return t.key=e,t}static addChild(t,e){var r;i.invariant(t),t.children=null!==(r=t.children)&&void 0!==r?r:[],t.children.push(e),a.setParent(e,t)}static removeChild(t,e){var i,r;t.children=null!==(r=null===(i=t.children)||void 0===i?void 0:i.filter((t=>t!==e)))&&void 0!==r?r:null}static addChildKey(t,e,r){var s;i.invariant(t),t.keys=null!==(s=t.keys)&&void 0!==s?s:{},t.keys[e]=r}static slice(t,e){i.isNullish(t.children)||(t.children.length=e)}static setData(t,e){t.data=e}static abort(t,e){i.isNullish(t.abortController)||t.abortController.abort(e)}}class n{static deserialize(t){const e=i.isStringValue(t)?JSON.parse(t):Object.assign({},t),s=r.expandObject(...e);n.validateIsolate(s);const l=[s];for(;l.length;){const t=l.shift();if(!t)continue;const e=t.children;e&&(t.children=e.map((e=>{var i;const r=Object.assign({},e);a.setParent(r,t),l.push(r);const s=r.key;return s&&(t.keys=null!==(i=t.keys)&&void 0!==i?i:{},t.keys[s]=r),r})))}return s}static serialize(t){if(i.isNullish(t))return"";const e=r.minifyObject(t,s);return JSON.stringify(e)}static validateIsolate(r){i.invariant(i.hasOwnProperty(r,e.Type),i.text(t.INVALID_ISOLATE_CANNOT_PARSE))}}exports.IsolateSerializer=n;
//# sourceMappingURL=IsolateSerializer.production.js.map
